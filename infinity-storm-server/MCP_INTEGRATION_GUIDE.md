# MCP (Model Context Protocol) Integration Guide
**Infinity Storm Casino Game - Database Integration**

## Overview
This document provides comprehensive guidance for using Claude AI's MCP capabilities to interact directly with the Supabase/PostgreSQL database for rapid development and testing.

## Quick Start

### 1. Environment Setup
Ensure your environment is properly configured:
```bash
# Start Supabase (requires Docker Desktop)
cd infinity-storm-server
supabase start

# Verify connection
node test-mcp-integration.js
```

### 2. Database Connection
- **URL**: http://127.0.0.1:54321
- **Database**: PostgreSQL 15+
- **Tables**: users, spins, game_sessions, cascade_steps, transaction_logs

## MCP Commands Reference

### Player Management
```
"Show me all active players sorted by balance"
"Create a new player with username 'test_user' and balance 2000"
"Update player 'demo_player' to add 500 to their balance"
"Find player by email 'demo@infinitystorm.dev'"
```

### Game Data Analysis
```
"Show the last 50 spins with their win amounts"
"Calculate the RTP for all spins this week"
"Find spins where the win was more than 10x the bet"
"Show me the distribution of bet amounts"
```

### Revenue Analytics
```
"Generate a daily revenue report for the last 30 days"
"Show total bets vs wins by day"
"Find the highest winning spin in the database"
"Calculate average bet size per player"
```

### Data Validation
```
"Check for any spins with negative win amounts"
"Find users with balances below 0"
"Validate that all spins have matching cascade data"
"Count records in each table"
```

## Development Workflow

### 1. Schema Changes
When modifying the database schema:
1. Update `supabase/seed.sql`
2. Run `supabase db reset` to apply changes
3. Use MCP to verify new tables/columns work correctly

### 2. Data Testing
For testing game logic:
1. Use MCP to insert test spin data
2. Verify calculations and relationships
3. Clean up test data when done

### 3. Performance Analysis
Monitor database performance:
1. Use MCP to check query execution times
2. Analyze index usage
3. Identify slow queries

## Security Considerations

### Service Role vs Anonymous Access
- **Service Role**: Full database access for development
- **Anonymous**: Limited to public tables only
- **Production**: Never expose service role keys

### Data Privacy
- Avoid logging sensitive user information
- Use prepared statements for all queries
- Implement proper access controls

## Troubleshooting

### Common Issues
1. **Connection Failed**: Ensure Docker Desktop is running and Supabase is started
2. **Permission Denied**: Check that service role key is correctly set
3. **Table Not Found**: Run database migrations with `supabase db reset`

### Debugging Commands
```sql
-- Check database status
SELECT health_check();

-- Verify table structure
\dt public.*

-- Check recent activity
SELECT * FROM pg_stat_activity WHERE state = 'active';
```

## Best Practices

### 1. Query Optimization
- Use appropriate indexes for frequent queries
- Limit result sets with proper WHERE clauses
- Use EXPLAIN to analyze query performance

### 2. Data Integrity
- Always use transactions for multi-step operations
- Validate input data before insertion
- Use foreign key constraints to maintain relationships

### 3. Development Safety
- Use test data that's clearly marked
- Back up important data before major changes
- Test queries on small datasets first

## Integration Examples

### Real-time Game Monitoring
```
"Show me all spins in the last 5 minutes with their results"
"Alert me if any player has lost more than $1000 in the last hour"
"Monitor for unusual win patterns or potential issues"
```

### Business Intelligence
```
"What's our house edge over the last 1000 spins?"
"Which symbols appear most frequently in winning combinations?"
"How does player behavior change based on balance levels?"
```

---
Generated by MCP Integration Test Suite v1.0
For technical support, refer to the Supabase documentation or project CLAUDE.md
